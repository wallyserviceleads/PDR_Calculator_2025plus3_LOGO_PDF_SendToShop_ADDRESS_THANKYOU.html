<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDR Estimate • Dark v2 (2025 Send to Shop)</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <header class="brand">
      <a class="logo" id="logoLink" href="#" target="_blank" rel="noopener"><img id="brandLogo" alt="Logo"/></a>
      <div>
        <div class="row">
          <span class="badge" id="brandBadge">PDR Estimate</span>
          <span class="pill">Non‑Hail • 2025</span>
        </div>
        <h1>Instant Paintless Dent Repair Estimate</h1>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <div class="col-8">
          <label>How big is the dent?</label>
          <div class="row" role="group" aria-label="Calculation mode">
            <label class="chip"><input type="radio" name="mode" value="length" checked/> Longest measurement</label>
            <label class="chip"><input type="radio" name="mode" value="area"/> Length × Width</label>
            <div class="help">Not sure? Measure across the widest part. If both sides are 10″+, we’ll switch to area pricing.</div>
          </div>
          <div class="row" style="margin-top:8px">
            <div style="min-width:160px;flex:1">
              <label for="lengthIn">Length (inches)</label>
              <input type="number" id="lengthIn" min="1" step="1.0" placeholder="e.g., 2.0" required/>
              <div class="error" id="lengthErr"></div>
            </div>
            <div style="min-width:160px;flex:1" id="widthWrap" hidden>
              <label for="widthIn">Width (inches)</label>
              <input type="number" id="widthIn" min="1" step="1.0" placeholder="e.g., 3.0" required/>
              <div class="error" id="widthErr"></div>
            </div>
          </div>
        </div>

        <div class="col-4">
          <label>Where is the dent? (for R&I access)</label>
          <select id="panelPick">
            <option value="door">Door (avg R&I 0.3h)</option>
            <option value="fender">Fender (0.3h)</option>
            <option value="hood">Hood (0.3h)</option>
            <option value="roof">Roof (2.0h)</option>
            <option value="quarter">Quarter Panel (0.3h)</option>
            <option value="bedside">Bedside (0.2h)</option>
            <option value="liftgate">Liftgate/Tailgate (0.5h)</option>
            <option value="trunk">Trunk (0.3h)</option>
            <option value="bumper">Bumper (1.0h)</option>
          </select>
          <div class="note" style="margin-top:8px">
            <strong>How we calculate:</strong> % upcharges apply to the <em>base PDR amount only</em> (not to R&amp;I or extras). 
            We also include typical R&amp;I time for access on the selected panel (at $85/hr). Non‑hail estimates.
          </div>
        </div>

        <div class="col-8">
          <label>Simplified difficulty (depth/shape)</label>
          <div class="row">
            <label class="chip"><input type="radio" name="depth" value="0" checked/> Shallow (easier)</label>
            <label class="chip"><input type="radio" name="depth" value="15"/> Medium (+15%)</label>
            <label class="chip"><input type="radio" name="depth" value="30"/> Deep (+30%)</label>
          </div>
          <div class="help">If the metal looks sharply creased or very pushed-in, pick Deep. Otherwise Shallow or Medium is fine.</div>
        </div>

        <div class="col-4">
          <label>Common factors (optional)</label>
          <div class="row">
            <label class="chip"><input type="checkbox" value="25" class="factor" data-name="On a body line"/> Body line (+25%)</label>
            <label class="chip"><input type="checkbox" value="25" class="factor" data-name="Glue pull needed"/> Glue pull (+25%)</label>
            <label class="chip"><input type="checkbox" value="25" class="factor" data-name="Edge of panel"/> Edge of panel (+25%)</label>
          </div>
          <div class="help">If you're unsure, leave these off. We’ll confirm in person.</div>
        </div>

        <div class="col-8">
          <label>Extras</label>
          <div class="row">
            <label class="chip"><input type="checkbox" id="polishAdd" /> May require polishing/corrosion protection (+$25.50)</label>
          </div>
        </div>

        <div class="col-4">
          <label>Contact (optional – helps us follow up)</label>
          <input type="text" id="custName" placeholder="Name" style="margin-bottom:8px" required/>
          <div class="error" id="nameErr"></div>
          <input type="tel" id="custPhone" placeholder="Phone" style="margin-bottom:8px" required/>
          <input type="email" id="custEmail" placeholder="Email" required/>
          <div class="error" id="contactErr"></div>
        </div>

        <div class="col-12 row no-print" id="actionRow" style="margin-top:6px">
          <button id="calcBtn">Get My Estimate</button>
          <button class="secondary" id="sendBtn" title="Send to Shop" style="display:none">Send to Shop</button>
          <button class="secondary" id="printBtn" title="Download PDF / Print" style="display:none">Download PDF / Print</button>
        </div>

        <div class="col-12">
          <div class="success" id="successMsg">Thank you! We received your estimate. We'll reach out shortly.</div>
          <div class="result" id="resultBox" aria-live="polite" style="display:none;"></div>
        </div>
      </div>
      <div class="help" style="margin-top:10px">Final pricing may vary after an in‑person evaluation.</div>
    </div>
  </div>

  <!-- PRINT SUMMARY (rendered only on print) -->
  <div class="print-sheet" id="printSheet">
    <div class="print-header">
      <img id="printLogo" alt="Logo"/>
      <div>
        <div class="print-title" id="printBrand">Columbia Dent Company</div>
        <div id="printContact"></div>
      </div>
    </div>
    <div class="kv">
      <div><strong>Date</strong></div><div id="psDate"></div>
      <div><strong>Customer</strong></div><div id="psCust"></div>
      <div><strong>Panel</strong></div><div id="psPanel"></div>
      <div><strong>Base</strong></div><div id="psBase"></div>
      <div><strong>Upcharges on Base</strong></div><div id="psPct"></div>
      <div><strong>R&I</strong></div><div id="psRI"></div>
      <div><strong>Extras</strong></div><div id="psExtras"></div>
      <div><strong>Estimated Range</strong></div><div id="psRange"></div>
    </div>
    <p style="margin-top:16px;font-size:12px;color:#555">Estimate is for non‑hail PDR based on customer inputs. Final pricing may vary after in‑person evaluation.</p>
  </div>

<script src="app.js"></script>

:root{
      --bg:#000000;
      --card:#0b0b0b;
      --muted:#9CA3AF;
      --text:#ffffff;
      --accent:#FA0000;
      --ring: rgba(250,0,0,.2);
      --pill:#111827;
      --outline: rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      line-height:1.45;
    }
    .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
    header.brand{display:flex;align-items:center;gap:14px;margin-bottom:16px;flex-wrap:wrap}
    .logo{
      width:56px;height:56px;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;
      background:#111;border:1px solid var(--outline)
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    h1{margin:0;font-size:22px;font-weight:800;letter-spacing:-.2px}
    .badge{background:var(--accent);color:#fff;padding:6px 10px;border-radius:999px;font-weight:800;letter-spacing:.2px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
    .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
    @media(max-width:900px){.col-8,.col-6,.col-4,.col-3{grid-column:span 12}}
    .card{
      background:var(--card);border-radius:16px;padding:16px;border:1px solid var(--outline);box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .note{background:#101318;border:1px solid var(--outline);border-radius:12px;padding:10px;color:#e5e7eb}
    label{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin-bottom:6px}
    input[type="number"],input[type="text"],input[type="email"],input[type="tel"],select{
      width:100%;background:#0d0d0d;border:1px solid var(--outline);border-radius:12px;padding:12px 12px;color:var(--text);
      outline:none;font-size:16px;transition:border-color .15s,box-shadow .15s
    }
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
    .chip{display:inline-flex;align-items:center;gap:8px;background:#0d0d0d;padding:10px 12px;border-radius:999px;border:1px solid var(--outline);font-size:14px;cursor:pointer}
    .help{font-size:12px;color:var(--muted)}
    button{
      appearance:none;border:0;background:var(--accent);color:white;padding:12px 16px;border-radius:12px;font-weight:800;font-size:16px;
      cursor:pointer;box-shadow:0 8px 22px rgba(250,0,0,.25)
    }
    button.secondary{background:#111827;box-shadow:none;border:1px solid var(--outline)}
    .result{background:#0f1220;color:#e5e7eb;border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,.06)}
    .result strong{color:#fff}
    .pill{display:inline-block;padding:2px 8px;background:#101318;border:1px solid var(--outline);border-radius:999px;font-size:12px;margin-right:6px}
    .divider{height:1px;background:var(--outline);margin:16px 0}
    .success{display:none;margin-top:10px;padding:10px;border-radius:10px;background:#0c1f12;border:1px solid rgba(16,185,129,.3);color:#a7f3d0}
    /* Print styles for the PDF summary */
    @media print{
      body{background:white;color:#111}
      .no-print{display:none!important}
      .print-sheet{display:block!important}
    }
    .print-sheet{display:none;background:white;color:#111;padding:24px;max-width:800px;margin:0 auto}
    .print-header{display:flex;gap:12px;align-items:center;border-bottom:2px solid #e5e7eb;padding-bottom:12px;margin-bottom:16px}
    .print-header img{width:64px;height:64px;object-fit:contain}
    .print-title{font-size:22px;font-weight:800}
    .kv{display:grid;grid-template-columns:180px 1fr;gap:8px;margin-top:8px}
    .kv div{padding:6px 8px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px}
// --- Brand & contact via URL params ---
const qp = new URLSearchParams(location.search);
const brand = qp.get('brand') || 'Columbia Dent Company';
const logo = qp.get('logo') || 'https://storage.googleapis.com/msgsndr/KINNI65MvR0NciOCHWzB/media/6657e11e1848ae80998c11f2.png';
const accent = qp.get('color') || '#FA0000';
const website = qp.get('website') || 'https://www.columbiadentcompany.com';
const phone = qp.get('phone') || '844-731-3368';
const email = qp.get('email') || 'Info@columbiadentcompany.com';
const address = qp.get('address') || ''; // provide via ?address=
document.documentElement.style.setProperty('--accent', accent);
document.documentElement.style.setProperty('--ring', `rgba(${hex2rgb(accent).join(',')},.2)`);
document.title = brand + ' • PDR Estimate';
document.getElementById('brandBadge').textContent = brand;
const logoImg = document.getElementById('brandLogo');
logoImg.src = logo; logoImg.alt = brand + ' logo';
const logoLink = document.getElementById('logoLink'); logoLink.href = website;

// Contact string for print
function contactLine(){
  const bits = [];
  if(address) bits.push(address);
  bits.push(phone);
  bits.push(email);
  bits.push(website.replace(/^https?:\/\//,''));
  return bits.join(' • ');
}

// Base pricing table (2024) + UPLIFT for 2025
const baseTable2024 = {
  1:173.59,2:249.18,3:324.77,4:400.36,5:475.95,
  6:551.54,7:627.13,8:702.72,9:778.31,10:853.90,
  11:929.49,12:1005.08,13:1080.67,14:1156.26,15:1231.85,
  16:1307.44,17:1383.03,18:1458.62,19:1534.21,20:1609.80,
  21:1685.39,22:1760.98,23:1836.57,24:1912.16,25:1987.75,
  26:2063.34,27:2138.93,28:2214.52,29:2290.11,30:2365.70,
  31:2441.29,32:2516.88,33:2592.47,34:2668.06,35:2743.65,
  36:2819.24,37:2894.83,38:2970.42,39:3046.01,40:3121.60,
  41:3197.19,42:3272.78,43:3348.37,44:3423.96,45:3499.55,
  46:3575.14,47:3650.73,48:3726.32,49:3801.91,50:3877.50
};
const UPLIFT = 1.03; // 2025 +3%

function getMode(){ const r=document.querySelector('input[name="mode"]:checked'); return r?r.value:'length'; }
function getBaseByLength(len){
  if(!isFinite(len) || len<=0) len = 1;
  const key = Math.min(50, Math.max(1, Math.ceil(len)));
  return baseTable2024[key] * UPLIFT;
}
function shouldUseArea(len,wid){ const area=len*wid; return (len>=10 && wid>=10) || area>100; }
function baseByArea(len,wid){ const rate = 6.5 * UPLIFT; return Math.max(0,len*wid)*rate; }
function money(n){ return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2}); }
function round5(n){ return Math.round(n/5)*5; }
function hex2rgb(hex){ const h=hex.replace('#',''); const b=parseInt(h,16); return [(b>>16)&255,(b>>8)&255,b&255]; }

// Labor
const LABOR_RATE = 85;
const POLISH_PROTECT_COST = 25.50;
const panelHours = {
  bumper: 1.0, fender: 0.3, door: 0.3, hood: 0.3,
  roof: 2.0, quarter: 0.3, bedside: 0.2, liftgate: 0.5, trunk: 0.3
};

// Toggle width for area mode
document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener('change', ()=>{
    document.getElementById('widthWrap').hidden = (getMode() !== 'area');
  });
});

function calc(){
  const len = Number(document.getElementById('lengthIn').value||'0');
  const wid = Number(document.getElementById('widthIn').value||'0');
  const mode = getMode();
  const depthPct = Number((document.querySelector('input[name="depth"]:checked')||{}).value || '0');
  const factorChecks = Array.from(document.querySelectorAll('.factor:checked'));
  const panelKey = (document.getElementById('panelPick').value || 'door');
  const riHours = panelHours[panelKey] || 0;
  const extraCost = document.getElementById('polishAdd').checked ? POLISH_PROTECT_COST : 0;


  // Base for 2025
  let base2025 = 0, used='length';
  if(mode==='area' && shouldUseArea(len,wid)){ base2025 = baseByArea(len,wid); used='area'; }
  else{ const longest=Math.max(len,wid||0,1); base2025 = getBaseByLength(longest); used='length'; }

  // Non-compounding upcharges on base only
  let pct = depthPct;
  const picked=[];
  if(depthPct>0) picked.push(depthPct===15?'Medium (+15%)':'Deep (+30%)');
  factorChecks.forEach(f=>{ const p=Number(f.value); pct+=p; picked.push(f.dataset.name+` (+${p}%)`); });
  const pdrTotal = base2025 * (1 + pct/100);

  const riCost = riHours * LABOR_RATE;

  const total = pdrTotal + riCost + extraCost;

  // Range
  const longestDim = Math.max(len,wid||0,1);
  const factorCount = picked.length;
  let highMarginBase = 0.42;
  if(longestDim<=3) highMarginBase = 0.45;
  else if(longestDim<=10) highMarginBase = 0.42;
  else if(longestDim<=15) highMarginBase = 0.50;
  else highMarginBase = 0.60;
  if(used==='area' || shouldUseArea(len,wid)) highMarginBase = Math.max(highMarginBase,0.60);
  const highMargin = Math.min(0.65, highMarginBase + 0.03*Math.max(0,factorCount));

  const low = round5(total*0.90);
  const high = round5(total*(1+highMargin));

  return {
    base2025, pct, pdrTotal, total, low, high, usedMode:used,
    riHours, riCost, extraCost, picked, panelKey, len, wid
  };
}

function panelName(key){
  return ({
    bumper:'Bumper', fender:'Fender', door:'Door', hood:'Hood', roof:'Roof',
    quarter:'Quarter Panel', bedside:'Bedside', liftgate:'Liftgate/Tailgate', trunk:'Trunk'
  })[key] || key;
}

document.getElementById('calcBtn').addEventListener('click', ()=>{
  const {base2025,pct,pdrTotal,total,low,high,usedMode,riHours,riCost,extraCost,picked,panelKey} = calc();
  const box = document.getElementById('resultBox');
  box.style.display='block';
  document.getElementById('sendBtn').style.display='inline-block';
  document.getElementById('printBtn').style.display='inline-block';
  document.getElementById('successMsg').style.display='none';

  box.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
      <div><strong>Estimated Range:</strong> <span class="pill">${money(low)}</span> to <span class="pill">${money(high)}</span></div>
      <div class="pill">${usedMode==='area'?'Square-Inch':'Longest'}</div>
    </div>
    <div class="divider"></div>
    <div><strong>Base:</strong> ${money(base2025)} • <strong>Upcharges on base:</strong> +${pct}%</div>
    <div><strong>R&I:</strong> ${panelName(panelKey)} (~${riHours.toFixed(1)}h @ $${LABOR_RATE}/hr = ${money(riCost)})${extraCost?` • <strong>Polish/Protect:</strong> ${money(extraCost)}`:''}</div>
    ${picked.length?`<div style="margin-top:8px"><strong>Selected factors:</strong> ${picked.map(d=>`<span class="pill">${d}</span>`).join(' ')}</div>`:''}
  `;
});

// PRINT / PDF
document.getElementById('printBtn').addEventListener('click', ()=>{
  const {base2025,pct,riHours,riCost,extraCost,low,high,usedMode,panelKey,len,wid} = calc();
  document.getElementById('printLogo').src = logo;
  document.getElementById('printBrand').textContent = brand;
  document.getElementById('printContact').textContent = contactLine();
  document.getElementById('psDate').textContent = new Date().toLocaleString();
  const cust = [document.getElementById('custName').value, document.getElementById('custPhone').value, document.getElementById('custEmail').value].filter(Boolean).join(' • ');
  document.getElementById('psCust').textContent = cust || '—';
  document.getElementById('psPanel').textContent = `${panelName(panelKey)} • Mode: ${usedMode}${usedMode==='area' ? ` (${len} × ${wid} in)` : ` (L=${len} in)`}`;
  document.getElementById('psBase').textContent = money(base2025);
  document.getElementById('psPct').textContent = `+${pct}% on base only`;
  document.getElementById('psRI').textContent = `${riHours.toFixed(1)}h @ $${LABOR_RATE}/hr = ${money(riCost)}`;
  document.getElementById('psExtras').textContent = extraCost ? money(extraCost) : '—';
  document.getElementById('psRange').textContent = `${money(low)} – ${money(high)}`;
  window.print();
});

// SEND TO SHOP (webhook/API) with CRM tag
document.getElementById('sendBtn').addEventListener('click', async ()=>{
  const webhook = qp.get('webhook') || '';
  if(!webhook){ alert('No webhook configured. Add ?webhook=<URL-ENCODED> to the page URL.'); return; }
  const {base2025,pct,pdrTotal,total,low,high,usedMode,riHours,riCost,extraCost,panelKey,len,wid,picked} = calc();
  const payload = {
    brand, logo, website, phone, email, address,
    contact_name: document.getElementById('custName').value || '',
    contact_phone: document.getElementById('custPhone').value || '',
    contact_email: document.getElementById('custEmail').value || '',
    panel: panelKey,
    ri_hours: riHours,
    ri_cost: riCost,
    extras_cost: extraCost,
    base2025,
    upcharge_percent_total: pct,
    pdr_total: pdrTotal,
    estimate_low: low,
    estimate_high: high,
    estimate_mid: Math.round((low+high)/2),
    mode_used: usedMode,
    inputs: { length_in: len, width_in: wid },
    factors: picked,
    tag: "pdr calculator",
    timestamp: new Date().toISOString(),
    source: "PDR Calculator • Send to Shop"
  };
  try{
    const res = await fetch(webhook,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!res.ok) throw new Error('non-ok');
    document.getElementById('successMsg').style.display='block';
    window.scrollTo({top:0,behavior:'smooth'});
  }catch(e){
    console.error(e);
    alert('Could not send to shop (CORS or URL issue).');
  }
});

</body>
</html>
    
